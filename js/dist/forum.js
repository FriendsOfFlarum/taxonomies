module.exports=function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=49)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e,o){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}o.d(e,"a",(function(){return n}))},function(t,e,o){"use strict";function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(e,"a",(function(){return n}))},function(t,e,o){"use strict";function n(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}o.d(e,"a",(function(){return n}))},function(t,e){t.exports=flarum.core.compat.extend},function(t,e,o){"use strict";e.a=function(t){return!1===t&&(t=[]),t.slice(0).sort((function(t,e){var o=t.order()-e.order();return 0!==o?o:t.name()>e.name()?1:t.name()<e.name()?-1:0}))}},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e,o){"use strict";o.d(e,"a",(function(){return a}));var n=o(18),r=o.n(n);function a(t,e,o){void 0===e&&(e={}),void 0===o&&(o={});var n=t&&t.icon(),a=o.useColor,s=void 0===a||a;return e.className=r()([e.className,"icon",n?t.icon():"TaxonomyIcon"]),t?(e.style=e.style||{},n?e.style.color=s?t.color():"":e.style.backgroundColor=t.color()):e.className+=" untagged",n?m("i",e):m("span",e)}},function(t,e,o){"use strict";o.d(e,"a",(function(){return c}));var n=o(0),r=o.n(n),a=o(12),s=o.n(a),i=o(8);function c(t,e){void 0===e&&(e={}),e.style=e.style||{},e.className="TaxonomyLabel "+(e.className||"");var o=s()(e,"link"),n=t?t.name():r.a.translator.trans("flarum-tags.lib.deleted_tag_text");if(t){var a,c=t.color();if(c&&(e.style.backgroundColor=e.style.color=c,e.className+=" colored"),o&&t.taxonomy())e.title=t.description()||"",e.href=r.a.route("index",((a={})[t.taxonomy().slug()]=t.slug(),a)),e.config=m.route}else e.className+=" untagged";return m(o?"a":"span",e,m("span.TaxonomyLabel-text",[t&&t.icon()&&Object(i.a)(t,{},{useColor:!1})," "+n]))}},function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));var n=o(12),r=o.n(n),a=o(9),s=o(11);function i(t,e){void 0===e&&(e={});var o=[],n=r()(e,"link");if(e.className="TaxonomiesLabel "+(e.className||""),t){var i=r()(e,"taxonomy");i||(i=t[0].taxonomy()),i&&(e["data-slug"]=i.slug(),i.showLabel()&&o.push(Object(a.a)(i,{className:"TaxonomyParentLabel"}))),Object(s.a)(t).forEach((function(e){(e||1===t.length)&&o.push(Object(a.a)(e,{link:n}))}))}else o.push(Object(a.a)());return m("span",e,o)}},function(t,e,o){"use strict";e.a=function(t){return t.slice(0).sort((function(t,e){var o=t.order()-e.order();return 0!==o?o:t.name()>e.name()?1:t.name()<e.name()?-1:0}))}},function(t,e){t.exports=flarum.core.compat["utils/extract"]},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e,o){"use strict";o.d(e,"a",(function(){return m}));var n=o(2),r=o(4),a=o(3),s=o(1),i=o.n(s),c=o(26),u=o.n(c),m=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,Object(a.a)(Object(n.a)(e),"type",i.a.attribute("type")),Object(a.a)(Object(n.a)(e),"name",i.a.attribute("name")),Object(a.a)(Object(n.a)(e),"slug",i.a.attribute("slug")),Object(a.a)(Object(n.a)(e),"description",i.a.attribute("description")),Object(a.a)(Object(n.a)(e),"color",i.a.attribute("color")),Object(a.a)(Object(n.a)(e),"icon",i.a.attribute("icon")),Object(a.a)(Object(n.a)(e),"order",i.a.attribute("order")),Object(a.a)(Object(n.a)(e),"showLabel",i.a.attribute("showLabel")),Object(a.a)(Object(n.a)(e),"showFilter",i.a.attribute("showFilter")),Object(a.a)(Object(n.a)(e),"allowCustomValues",i.a.attribute("allowCustomValues")),Object(a.a)(Object(n.a)(e),"customValueValidation",i.a.attribute("customValueValidation")),Object(a.a)(Object(n.a)(e),"customValueSlugger",i.a.attribute("customValueSlugger")),Object(a.a)(Object(n.a)(e),"minTerms",i.a.attribute("minTerms")),Object(a.a)(Object(n.a)(e),"maxTerms",i.a.attribute("maxTerms")),Object(a.a)(Object(n.a)(e),"createdAt",i.a.attribute("createdAt",i.a.transformDate)),Object(a.a)(Object(n.a)(e),"canSearchDiscussions",i.a.attribute("canSearchDiscussions")),Object(a.a)(Object(n.a)(e),"canSearchUsers",i.a.attribute("canSearchUsers")),Object(a.a)(Object(n.a)(e),"uniqueKey",u()("id",(function(t){return"taxonomy"+t}))),e}return Object(r.a)(e,t),e}(i.a)},function(t,e,o){"use strict";o.d(e,"a",(function(){return c}));var n=o(2),r=o(4),a=o(3),s=o(1),i=o.n(s),c=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,Object(a.a)(Object(n.a)(e),"name",i.a.attribute("name")),Object(a.a)(Object(n.a)(e),"slug",i.a.attribute("slug")),Object(a.a)(Object(n.a)(e),"description",i.a.attribute("description")),Object(a.a)(Object(n.a)(e),"color",i.a.attribute("color")),Object(a.a)(Object(n.a)(e),"icon",i.a.attribute("icon")),Object(a.a)(Object(n.a)(e),"order",i.a.attribute("order")),Object(a.a)(Object(n.a)(e),"createdAt",i.a.attribute("createdAt",i.a.transformDate)),Object(a.a)(Object(n.a)(e),"taxonomy",i.a.hasOne("taxonomy")),e}return Object(r.a)(e,t),e}(i.a)},function(t,e,o){"use strict";function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t}).apply(this,arguments)}var r=o(1),a=o.n(r);e.a=function(t){return t.id()?a.a.getIdentifier(t):n({},a.a.getIdentifier(t),{attributes:{name:t.name()}})}},function(t,e,o){"use strict";var n=o(6),r=o(10);e.a=function(t,e){void 0===e&&(e={});var o=[];return t.forEach((function(t){var e=t.taxonomy();-1===o.indexOf(e)&&o.push(e)})),Object(n.a)(o).map((function(o){return Object(r.a)(t.filter((function(t){return t.taxonomy()===o})),e)}))}},function(t,e){t.exports=flarum.core.compat["utils/classList"]},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));var n=o(17),r=o(8),a=o(9),s=o(10),i={labelsFromMultipleTaxonomiesList:n.a,taxonomyIcon:r.a,termLabel:a.a,termsLabel:s.a}},function(t,e,o){"use strict";o.d(e,"a",(function(){return a}));var n=o(14),r=o(15),a={Taxonomy:n.a,Term:r.a}},function(t,e,o){"use strict";o.d(e,"a",(function(){return s}));var n=o(6),r=o(11),a=o(16),s={sortTaxonomies:n.a,sortTerms:r.a,termToIdentifier:a.a}},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e,o){"use strict";var n=o(0),r=o.n(n),a=o(14),s=o(15);e.a=function(){r.a.store.models["fof-taxonomies"]=a.a,r.a.store.models["fof-taxonomy-terms"]=s.a}},function(t,e){t.exports=flarum.core.compat["utils/computed"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},,function(t,e){t.exports=flarum.core.compat["components/DiscussionComposer"]},,function(t,e){t.exports=flarum.core.compat["components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["models/Discussion"]},function(t,e){t.exports=flarum.core.compat["models/Forum"]},function(t,e){t.exports=flarum.core.compat["models/User"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["helpers/highlight"]},function(t,e){t.exports=flarum.core.compat["utils/KeyboardNavigatable"]},function(t,e){t.exports=flarum.core.compat["utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionListItem"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionHero"]},function(t,e){t.exports=flarum.core.compat["utils/UserControls"]},,,,,,function(t,e,o){"use strict";o.r(e),o.d(e,"components",(function(){return it})),o.d(e,"helpers",(function(){return ct.a})),o.d(e,"models",(function(){return ut.a})),o.d(e,"utils",(function(){return mt.a}));var n=o(0),r=o.n(n),a=o(32),s=o.n(a),i=o(33),c=o.n(i),u=o(34),l=o.n(u),f=o(1),p=o.n(f),d=o(5),h=o(29),x=o.n(h),b=o(27),y=o.n(b),v=o(4),T=o(23),g=o.n(T),O=o(35),j=o.n(O),w=o(7),I=o.n(w),C=o(13),L=o.n(C),E=o(36),S=o.n(E),F=o(18),D=o.n(F),q=o(19),P=o.n(q),M=o(37),N=o.n(M),k=o(9),K=o(8),_=o(16);var V=function(t){function e(){return t.apply(this,arguments)||this}Object(v.a)(e,t);var o=e.prototype;return o.init=function(){var e=this;t.prototype.init.call(this),this.availableTerms=null,this.selectedTerms=[],this.searchFilter="",this.activeListIndex=0,this.inputIsFocused=!1,this.props.selectedTerms?this.props.selectedTerms.forEach(this.addTerm.bind(this)):this.props.resource&&this.props.resource.taxonomyTerms().forEach((function(t){t.taxonomy().id()===e.props.taxonomy.id()&&e.addTerm(t)})),r.a.request({method:"GET",url:r.a.forum.attribute("apiUrl")+this.props.taxonomy.apiEndpoint()+"/terms"}).then((function(t){e.availableTerms=r.a.store.pushPayload(t),m.redraw()})),this.navigator=new N.a,this.navigator.onUp((function(){return e.setIndex(e.activeListIndex-1,!0)})).onDown((function(){return e.setIndex(e.activeListIndex+1,!0)})).onSelect(this.select.bind(this)).onRemove((function(){return e.selectedTerms.splice(e.selectedTerms.length-1,1)}))},o.indexInSelectedTerms=function(t){return this.selectedTerms.findIndex((function(e){return n=t,(o=e).data.type===n.data.type&&(o.id()&&n.id()?o.id()===n.id():!o.id()==!n.id()&&o.name()===n.name());var o,n}))},o.addTerm=function(t){this.selectedTerms.push(t)},o.removeTerm=function(t){var e=this.indexInSelectedTerms(t);-1!==e&&this.selectedTerms.splice(e,1)},o.className=function(){return"ChooseTaxonomyTermsModal"},o.title=function(){return this.props.resource?r.a.translator.trans("fof-taxonomies.forum.modal.title.edit",{taxonomy:this.props.taxonomy.name(),title:m("em",this.props.resource.title?this.props.resource.title():this.props.resource.displayName())}):r.a.translator.trans("fof-taxonomies.forum.modal.title.new",{taxonomy:this.props.taxonomy.name()})},o.getInstruction=function(){var t=this.selectedTerms.length;if(this.props.taxonomy.minTerms()&&t<this.props.taxonomy.minTerms()){var e=this.props.taxonomy.minTerms()-t;return r.a.translator.transChoice("fof-taxonomies.forum.modal.placeholder",e,{remaining:e})}return""},o.content=function(){var t=this,e=null===this.availableTerms?[]:this.availableTerms,o=this.searchFilter.toLowerCase();if(o&&(e=e.filter((function(t){return t.name().substr(0,o.length).toLowerCase()===o})),this.props.taxonomy.allowCustomValues()&&!e.some((function(t){return t.name().toLowerCase()===o})))){var n=this.props.taxonomy.customValueValidation(),a=null;if("alpha_num"===n)a=/^[a-z0-9]$/i;else if("alpha_dash"===n)a=/^[a-z0-9_-]$/i;else if(0===n.indexOf("/")){var s=n.split("/");3===s.length&&(a=new RegExp(s[1],s[2]))}a&&!a.test(this.searchFilter)||e.push(r.a.store.createRecord("fof-taxonomy-terms",{attributes:{name:this.searchFilter}}))}this.props.taxonomy.maxTerms()&&this.selectedTerms.length>=this.props.taxonomy.maxTerms()&&(e=[]);var i=this.props.taxonomy.description();return[m(".Modal-body",[i?m("p",i):null,m(".ChooseTaxonomyTermsModal-form",[m(".ChooseTaxonomyTermsModal-form-input",m(".TermsInput.FormControl",{className:this.inputIsFocused?"focus":""},[m("span.TermsInput-selected",this.selectedTerms.map((function(e){return m("span.TermsInput-term",{onclick:function(){t.removeTerm(e),t.onready()}},Object(k.a)(e))}))),m("input.FormControl",{placeholder:P()(this.getInstruction()),value:this.searchFilter,oninput:function(e){t.searchFilter=e.target.value,t.activeListIndex=0},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){return t.inputIsFocused=!0},onblur:function(){return t.inputIsFocused=!1}})])),m(".ChooseTaxonomyTermsModal-form-submit.App-primaryControl",I.a.component({type:"submit",className:"Button Button--primary",disabled:this.props.taxonomy.minTerms()&&this.selectedTerms.length<this.props.taxonomy.minTerms(),icon:"fas fa-check"},r.a.translator.trans("fof-taxonomies.forum.modal.submit")))])]),m(".Modal-footer",null===this.availableTerms?L.a.component():m("ul.ChooseTaxonomyTermsModal-list.SelectTermList",e.map((function(e,n){return m("li",{"data-index":n,className:D()({colored:!!e.color(),selected:-1!==t.indexInSelectedTerms(e),active:t.activeListIndex===n}),style:{color:e.color()},onmouseover:function(){return t.activeListIndex=n},onclick:t.toggleTerm.bind(t,e)},[Object(K.a)(e),m("span.SelectTermListItem-name",e.exists?S()(e.name(),o):r.a.translator.trans("fof-taxonomies.forum.modal.custom",{value:m("em",e.name())})),e.description()?m("span.SelectTermListItem-description",e.description()):""])}))))]},o.toggleTerm=function(t){-1!==this.indexInSelectedTerms(t)?this.removeTerm(t):this.addTerm(t),this.searchFilter&&(this.searchFilter="",this.activeListIndex=0),this.onready()},o.select=function(t){var e=this.getDomElement(this.activeListIndex);t.metaKey||t.ctrlKey||e.is(".selected")?this.selectedTerms.length&&this.$("form").submit():e[0].dispatchEvent(new Event("click"))},o.getDomElement=function(t){return this.$('li[data-index="'+t+'"]')},o.setIndex=function(t,e){var o=this.$(".ChooseTaxonomyTermsModal-list"),n=this.$(".ChooseTaxonomyTermsModal-list > li").length;t<0?t=n-1:t>=n&&(t=0);var r=this.getDomElement(t);if(this.activeListIndex=t,m.redraw(),e){var a,s=o.scrollTop(),i=o.offset().top,c=i+o.outerHeight(),u=r.offset().top,l=u+r.outerHeight();u<i?a=s-i+u-parseInt(o.css("padding-top"),10):l>c&&(a=s-c+l+parseInt(o.css("padding-bottom"),10)),void 0!==a&&o.stop(!0).animate({scrollTop:a},100)}},o.onsubmit=function(t){t.preventDefault(),this.props.resource?this.props.resource.save({relationships:{taxonomies:[{verbatim:!0,type:"fof-taxonomies",id:this.props.taxonomy.id(),relationships:{terms:{data:this.selectedTerms.map(_.a)}}}]}}).then((function(){r.a.current instanceof j.a&&r.a.current.stream.update(),m.redraw(),r.a.modal.close()})):(this.props.onsubmit&&this.props.onsubmit(this.selectedTerms),r.a.modal.close(),m.redraw.strategy("none"))},e}(g.a),U=o(10),A=o(6),z=o(38),$=o.n(z),B=o(31),R=o.n(B),G=o(39),H=o.n(G),J=o(24),Q=o.n(J),W=o(40),X=o.n(W),Y=function(t){function e(){return t.apply(this,arguments)||this}Object(v.a)(e,t);var o=e.prototype;return o.init=function(){this.termsInitialized=!1,this.terms=null,this.props.activeTermSlug&&this.loadTerms()},o.loadTerms=function(){var t=this;this.termsInitialized||(this.termsInitialized=!0,r.a.request({method:"GET",url:r.a.forum.attribute("apiUrl")+this.props.taxonomy.apiEndpoint()+"/terms"}).then((function(e){t.terms=r.a.store.pushPayload(e),t.terms.forEach((function(e){e.pushData({relationships:{taxonomy:t.props.taxonomy}})})),m.redraw()})))},o.view=function(){var t=this,e=this.terms&&this.terms.find((function(e){return e.slug()===t.props.activeTermSlug}));return X.a.component({buttonClassName:"Button",label:this.props.taxonomy.name()+(e?": "+e.name():""),onshow:function(){t.loadTerms()}},null===this.terms?[L.a.component()]:this.terms.map((function(e){var o=t.props.activeTermSlug===e.slug();return I.a.component({icon:!o||"fas fa-check",onclick:function(){return t.props.onchange(e)},active:o},e.name())})))},e}(Q.a),Z=o(41),tt=o.n(Z),et=o(42),ot=o.n(et),nt=o(17),rt=o(43),at=o.n(rt),st=o(25),it={ChooseTaxonomyTermsModal:V,TaxonomyDropdown:Y},ct=o(20),ut=o(21),mt=o(22);r.a.initializers.add("fof-taxonomies",(function(){Object(d.extend)(x.a.prototype,"headerItems",(function(t){var e=this;Object(A.a)(r.a.forum.taxonomies()).forEach((function(o){"discussions"===o.type()&&t.add("taxonomy-"+o.slug(),m("a.DiscussionComposer-changeTaxonomies",{onclick:function(){r.a.modal.show(new V({taxonomy:o,selectedTerms:(e[o.uniqueKey()]||[]).slice(0),onsubmit:function(t){e[o.uniqueKey()]=t,e.$("textarea").focus()}}))}},e[o.uniqueKey()]&&e[o.uniqueKey()].length?Object(U.a)(e[o.uniqueKey()],{taxonomy:o}):m("span.TaxonomyLabel.untagged",[o.icon()?[y()(o.icon())," "]:null,r.a.translator.trans("fof-taxonomies.forum.composer.choose",{taxonomy:o.name()})])),9)}))})),Object(d.override)(x.a.prototype,"onsubmit",(function(t){var e=this,o=[];if(Object(A.a)(r.a.forum.taxonomies()).forEach((function(t){if("discussions"===t.type()){var n=(e[t.uniqueKey()]||[]).length;t.minTerms()&&n<t.minTerms()&&o.push((function(o){r.a.modal.show(new V({taxonomy:t,selectedTags:(e[t.uniqueKey()]||[]).slice(0),onsubmit:function(n){e[t.uniqueKey()]=n,o()}}))}))}})),o.length){var n=function e(){o.length?new Promise(o.shift()).then((function(){setTimeout((function(){e()}),400)})):t()};r.a.modal.showing?setTimeout((function(){n()}),400):n()}else t()})),Object(d.extend)(x.a.prototype,"data",(function(t){var e=this,o=[];r.a.forum.taxonomies().forEach((function(t){"discussions"===t.type()&&e[t.uniqueKey()]&&e[t.uniqueKey()].length&&o.push({verbatim:!0,type:"fof-taxonomies",id:t.id(),relationships:{terms:{data:e[t.uniqueKey()].map(_.a)}}})})),t.relationships=t.relationships||{},t.relationships.taxonomies=o})),Object(d.override)(p.a,"getIdentifier",(function(t,e){return e.verbatim?(delete e.verbatim,e):t(e)})),Object(d.extend)($.a,"moderationControls",(function(t,e){e.attribute("fofCanEditTaxonomies")&&Object(A.a)(r.a.forum.taxonomies()).forEach((function(o){"discussions"===o.type()&&t.add("taxonomy-"+o.slug(),I.a.component({icon:"fas fa-tag",onclick:function(){return r.a.modal.show(new V({resource:e,taxonomy:o}))}},r.a.translator.trans("fof-taxonomies.forum.discussion.edit",{taxonomy:o.name()})))}))})),Object(d.extend)(R.a.prototype,"viewItems",(function(t){var e=this;Object(A.a)(r.a.store.all("fof-taxonomies")).forEach((function(o){o.canSearchDiscussions()&&o.showFilter()&&t.add("taxonomy-"+o.slug(),Y.component({taxonomy:o,activeTermSlug:e.params()[o.slug()],onchange:function(t){var n=e.params(),a=n[o.slug()];t.slug()===a?delete n[o.slug()]:n[o.slug()]=t.slug(),m.route(r.a.route(e.props.routeName,n))}}))}))})),Object(d.extend)(R.a.prototype,"stickyParams",(function(t){Object(A.a)(r.a.store.all("fof-taxonomies")).filter((function(t){return t.canSearchDiscussions()&&t.showFilter()})).forEach((function(e){t[e.slug()]=m.route.param(e.slug())}))})),Object(d.extend)(H.a.prototype,"requestParams",(function(t){var e=this;t.include.push("taxonomyTerms","taxonomyTerms.taxonomy"),Object(A.a)(r.a.store.all("fof-taxonomies")).filter((function(t){return function(t){return t.canSearchDiscussions()&&t.showFilter()}})).forEach((function(o){var n=e.props.params[o.slug()];n&&(t.filter.q=(t.filter.q||"")+" taxonomy:"+o.slug()+":"+n)}))})),Object(d.extend)(tt.a.prototype,"infoItems",(function(t){var e=this.props.discussion.taxonomyTerms();e&&e.length&&t.add("taxonomies",Object(nt.a)(e),10)})),Object(d.extend)(ot.a.prototype,"items",(function(t){var e=this.props.discussion.taxonomyTerms();e&&e.length&&t.add("taxonomies",Object(nt.a)(e,{link:!0}),5)})),Object(d.extend)(at.a,"userControls",(function(t,e){e.attribute("fofCanEditTaxonomies")&&Object(A.a)(r.a.forum.taxonomies()).forEach((function(o){"users"===o.type()&&t.add("taxonomy-"+o.slug(),I.a.component({icon:"fas fa-tag",onclick:function(){return r.a.modal.show(new V({resource:e,taxonomy:o}))}},r.a.translator.trans("fof-taxonomies.forum.user.edit",{taxonomy:o.name()})))}))})),Object(st.a)(),function(){if(flarum.extensions["fof-user-directory"]&&flarum.extensions["fof-user-directory"].searchTypes&&flarum.extensions["fof-user-directory"].searchTypes.AbstractType&&flarum.extensions["fof-user-directory"].components&&flarum.extensions["fof-user-directory"].components.SearchField){var t=function(t){function e(){var e;return(e=t.call(this)||this).allTerms=null,e}Object(v.a)(e,t);var o=e.prototype;return o.resourceType=function(){return"fof-taxonomy-terms"},o.search=function(t){var e=this;this.loading=!0,this.loadTerms().then((function(){e.loading=!1,e.suggestions=[],t&&(t=t.toLowerCase(),e.allTerms.forEach((function(o){-1!==o.name().toLowerCase().indexOf(t)&&e.suggestions.push(o)})),m.redraw())}))},o.loadTerms=function(){var t=this;if(null!==this.allTerms)return Promise.resolve(null);this.allTerms=[];var e=[];return r.a.store.all("fof-taxonomies").forEach((function(o){o.canSearchUsers()&&o.showFilter()&&e.push(r.a.request({method:"GET",url:r.a.forum.attribute("apiUrl")+o.apiEndpoint()+"/terms"}).then((function(e){var n,a=r.a.store.pushPayload(e);a.forEach((function(t){t.pushData({relationships:{taxonomy:o}})})),(n=t.allTerms).push.apply(n,a)})))})),Promise.all(e)},o.renderKind=function(t){return t.taxonomy().name()},o.renderLabel=function(t){return m(".UserDirectorySearchLabel",t.color()?{className:"colored",style:{backgroundColor:t.color()}}:{},[t.icon()?[y()(t.icon())," "]:null,t.name()])},o.applyFilter=function(t,e){t.q=t.q?t.q+" ":"",t.q+="taxonomy:"+e.taxonomy().slug()+":"+e.slug()},o.initializeFromParams=function(t){var e=this;if(!t.q)return Promise.resolve([]);var o=t.q.split(" ").filter((function(t){return 0===t.indexOf("taxonomy:")}));return o.length?this.loadTerms().then((function(){var t=[];return o.forEach((function(o){var n=o.split(":");if(!(n.length<3)){var r=e.allTerms.find((function(t){return t.slug()===n[2]&&t.taxonomy().slug()===n[1]}));r&&t.push(r)}})),t})):Promise.resolve([])},e}(flarum.extensions["fof-user-directory"].searchTypes.AbstractType);Object(d.extend)(flarum.extensions["fof-user-directory"].components.SearchField.prototype,"filterTypes",(function(e){e.add("fof-taxonomies",new t,15)}))}}(),c.a.prototype.taxonomies=p.a.hasMany("taxonomies"),s.a.prototype.taxonomyTerms=p.a.hasMany("taxonomyTerms"),l.a.prototype.taxonomyTerms=p.a.hasMany("taxonomyTerms")}))}]);
//# sourceMappingURL=forum.js.map